// RUN: marco --omc-bypass --model=ArrayVariablesSubstitution --end-time=1 --time-step=0.1 --solver=ida --ida-equidistant-time-grid -o %basename_t %s
// RUN: ./%basename_t --precision=6 | FileCheck %s

// CHECK: "time","Q[1]","Q[2]","Q[3]","Q[4]","Q[5]","T[1]","T[2]","T[3]","T[4]"
// CHECK-NEXT: 0.000000,10.000000,0.000000,0.000000,0.000000,10.000000,100.000000,100.000000,100.000000,100.000000
// CHECK-NEXT: 0.100000,10.000000,0.909425,0.087490,0.909425,10.000000,100.953170,100.043745,99.956255,99.046830
// CHECK-NEXT: 0.200000,10.000000,1.668431,0.309525,1.668431,10.000000,101.823194,100.154762,99.845238,98.176806
// CHECK-NEXT: 0.300000,10.000000,2.314437,0.617672,2.314437,10.000000,102.623273,100.308836,99.691164,97.376727
// CHECK-NEXT: 0.400000,10.000000,2.873860,0.978749,2.873860,10.000000,103.363235,100.489375,99.510625,96.636765
// CHECK-NEXT: 0.500000,10.000000,3.366123,1.369246,3.366123,10.000000,104.050746,100.684623,99.315377,95.949254
// CHECK-NEXT: 0.600000,10.000000,3.805270,1.773035,3.805270,10.000000,104.691788,100.886518,99.113482,95.308212
// CHECK-NEXT: 0.700000,10.000000,4.201578,2.179098,4.201578,10.000000,105.291128,101.089549,98.910451,94.708872
// CHECK-NEXT: 0.800000,10.000000,4.562656,2.579994,4.562656,10.000000,105.852653,101.289997,98.710003,94.147347
// CHECK-NEXT: 0.900000,10.000000,4.894203,2.970791,4.894203,10.000000,106.379599,101.485396,98.514604,93.620401
// CHECK-NEXT: 1.000000,10.000000,5.200433,3.348477,5.200433,10.000000,106.874672,101.674239,98.325761,93.125328

model ArrayVariablesSubstitution
  Real[4] T(start = 100.0);
  Real[5] Q;
equation
  for i in 1:4 loop
    der(T[i]) = Q[i] - Q[i + 1];
  end for;

  Q[1] = 10;

  for i in 2:4 loop
    Q[i] = T[i - 1] - T[i];
  end for;

  Q[5] = 10;
end ArrayVariablesSubstitution;
