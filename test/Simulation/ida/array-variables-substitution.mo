// RUN: marco --omc-bypass --model=ArrayVariablesSubstitution --end-time=1 --time-step=0.1 --solver=ida --ida-equidistant-time-grid -o %basename_t %s
// RUN: ./%basename_t --precision=6 | FileCheck %s

// CHECK: time;Q[1];Q[2];Q[3];Q[4];Q[5];T[1];T[2];T[3];T[4]
// CHECK-NEXT: 0.000000;10.000000;0.000000;0.000000;0.000000;10.000000;100.000000;100.000000;100.000000;100.000000
// CHECK-NEXT: 0.100000;10.000000;0.909436;0.087477;0.909436;10.000000;100.953175;100.043738;99.956262;99.046825
// CHECK-NEXT: 0.200000;10.000000;1.668432;0.309524;1.668432;10.000000;101.823194;100.154762;99.845238;98.176806
// CHECK-NEXT: 0.300000;10.000000;2.314432;0.617678;2.314432;10.000000;102.623271;100.308839;99.691161;97.376729
// CHECK-NEXT: 0.400000;10.000000;2.873864;0.978744;2.873864;10.000000;103.363236;100.489372;99.510628;96.636764
// CHECK-NEXT: 0.500000;10.000000;3.366123;1.369249;3.366123;10.000000;104.050748;100.684625;99.315375;95.949252
// CHECK-NEXT: 0.600000;10.000000;3.805179;1.773162;3.805179;10.000000;104.691760;100.886581;99.113419;95.308240
// CHECK-NEXT: 0.700000;10.000000;4.201431;2.179297;4.201431;10.000000;105.291079;101.089648;98.910352;94.708921
// CHECK-NEXT: 0.800000;10.000000;4.562543;2.580143;4.562543;10.000000;105.852615;101.290071;98.709929;94.147385
// CHECK-NEXT: 0.900000;10.000000;4.894092;2.970937;4.894092;10.000000;106.379561;101.485468;98.514532;93.620439
// CHECK-NEXT: 1.000000;10.000000;5.200349;3.348585;5.200349;10.000000;106.874642;101.674292;98.325708;93.125358

model ArrayVariablesSubstitution
  Real[4] T(start = 100.0);
  Real[5] Q;
equation
  for i in 1:4 loop
    der(T[i]) = Q[i] - Q[i + 1];
  end for;

  Q[1] = 10;

  for i in 2:4 loop
    Q[i] = T[i - 1] - T[i];
  end for;

  Q[5] = 10;
end ArrayVariablesSubstitution;
