// RUN: marco --omc-bypass --model=ArrayVariablesSubstitution -v --solver=ida -o %basename_t %s -L %runtime_lib_dir -L %sundials_lib_dir
// RUN: ./%basename_t --end-time=1 --time-step=0.1 --precision=4 | FileCheck %s

// CHECK: "time","Q[1]","Q[2]","Q[3]","Q[4]","Q[5]","T[1]","T[2]","T[3]","T[4]"
// CHECK-NEXT: 0.0000,10.0000,0.0000,0.0000,0.0000,10.0000,100.0000,100.0000,100.0000,100.0000
// CHECK-NEXT: 0.1000,10.0000,0.9094,0.0875,0.9094,10.0000,100.9532,100.0437,99.9563,99.0468
// CHECK-NEXT: 0.2000,10.0000,1.6684,0.3095,1.6684,10.0000,101.8232,100.1548,99.8452,98.1768
// CHECK-NEXT: 0.3000,10.0000,2.3144,0.6177,2.3144,10.0000,102.6233,100.3088,99.6912,97.3767
// CHECK-NEXT: 0.4000,10.0000,2.8739,0.9787,2.8739,10.0000,103.3632,100.4894,99.5106,96.6368
// CHECK-NEXT: 0.5000,10.0000,3.3661,1.3692,3.3661,10.0000,104.0507,100.6846,99.3154,95.9493
// CHECK-NEXT: 0.6000,10.0000,3.8053,1.7730,3.8053,10.0000,104.6918,100.8865,99.1135,95.3082
// CHECK-NEXT: 0.7000,10.0000,4.2016,2.1791,4.2016,10.0000,105.2911,101.0895,98.9105,94.7089
// CHECK-NEXT: 0.8000,10.0000,4.5627,2.5800,4.5627,10.0000,105.8527,101.2900,98.7100,94.1473
// CHECK-NEXT: 0.9000,10.0000,4.8942,2.9708,4.8942,10.0000,106.3796,101.4854,98.5146,93.6204
// CHECK-NEXT: 1.0000,10.0000,5.2004,3.3485,5.2004,10.0000,106.8747,101.6742,98.3258,93.1253

model ArrayVariablesSubstitution
  Real[4] T(each start = 100.0, fixed = true);
  Real[5] Q;
equation
  for i in 1:4 loop
    der(T[i]) = Q[i] - Q[i + 1];
  end for;

  Q[1] = 10;

  for i in 2:4 loop
    Q[i] = T[i - 1] - T[i];
  end for;

  Q[5] = 10;
end ArrayVariablesSubstitution;
